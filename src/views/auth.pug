doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Authentication
    link(rel="stylesheet" href="/css/auth.css")
  body
    .container
      .form-container
        h1 Authentication

        .form-section
          h2 Login
          form(action="/v1/api/auth/login" method="post")
            .form-group
              label(for="login-username") Username
              input(type="text" id="login-username" name="username" required placeholder="Your username")
            .form-group
              label(for="login-password") Password
              input(type="password" id="login-password" name="password" required placeholder = "Your password")
            button(type="submit" id="btn_login") Login

        .form-section
          h2 Register
          form(action="/v1/api/auth/register" method="post")
            .form-group
              label(for="register-username") Username
              input(type="text" id="register-username" name="username" required placeholder = "Your username")
            .form-group
              label(for="register-email") Email
              input(type="email" id="register-email" name="email" required placeholder = "Your email")
            .form-group
              label(for="register-password") Password
              input(type="password" id="register-password" name="password" required placeholder = "Your password")
            button(type="submit" id="btn_register") Register

    script.
      const btn_login = document.querySelector('#btn_login');
      const btn_register = document.querySelector('#btn_register');
      const loginUsername = document.querySelector('#login-username');
      const loginPassword = document.querySelector('#login-password');
      const registerUsername = document.querySelector('#register-username');
      const registerEmail = document.querySelector('#register-email');
      const registerPassword = document.querySelector('#register-password');

      btn_login.addEventListener('click', (e) => {
        e.preventDefault();
        const username = loginUsername.value;
        const password = loginPassword.value;
        const obj = { username, password };
        console.log(obj);
        fetch('/v1/api/auth/login', {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(obj)
        })
          .then(res => res.json())
          .then(data => {
            console.log('Data:::',data)
            if (data.statusCode === 200) {
                localStorage.setItem('accessToken', data.message.accessToken);
                window.location.href = '/v1/chat';
            }else{
                console.log(data.message);
                alert('Invalid username or password');
            }
          })
          .catch(err => console.error(err));

        loginUsername.value = '';
        loginPassword.value = '';
      });

      btn_register.addEventListener('click', (e) => {
        e.preventDefault();
        const username = registerUsername.value;
        const email = registerEmail.value;
        const password = registerPassword.value;

        fetch('/v1/api/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, email, password })
        })
          .then(res => res.json())
          .then(data => {
            if(data.statusCode === 200){
              alert('User registered successfully');
            }else{
                alert(data.message);
                }
          })
          .catch(err => console.error(err));

            registerUsername.value = '';
            registerEmail.value = '';
            registerPassword.value = '';
      });
